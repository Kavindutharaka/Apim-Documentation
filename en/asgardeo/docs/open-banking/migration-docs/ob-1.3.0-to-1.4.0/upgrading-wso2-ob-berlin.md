# WSO2 Open Banking Berlin (Upgrading from 1.1.0 to 1.3.0)

## Accounts and Payments tables

- A new column named `API_VERSION` is added to the `BG_ACCOUNT_INITIALIZATION` and `BG_PAYMENT_CONSENT` tables. These are used in the accounts and payments flows respectively.
- Run the relevant SQL migration script in the `<WSO2_OB_KM_HOME>/dbscripts/finance/berlin-group.org/migration-1.3.0_to_1.4.0` directory, against the `openbank_openbankingdb` database.

## Authorize payment cancellation

The AuthorizeCancellation property is introduced to configure whether PSU authorization is required for payment cancellation or not.

- Open the `<WSO2_OB_KM_HOME>/repository/conf/finance/open-banking.xml` file.
- Update the `<AuthorizeCancellation>` property, under `<Berlin>`.
- The possible values are:
    - `true`: Required to authorize the cancellation by completing authorization flow.
    - `false`: Authorization is not required.

      ```
      <Berlin>
          <AuthorizeCancellation>false</AuthorizeCancellation>
      </Berlin>
      ```
      
## Configure SCA methods

The `AuthenticationObject` property is introduced to configure the SCA methods for API responses.

- Open the `<WSO2_OB_KM_HOME>/repository/conf/finance/open-banking.xml` file and add the `AuthenticationObject` configurations.
- Depending on the risk management of the ASPSP this choice might be offered before or after the PSU has been identified with the first relevant factor, or if an access token is transported.

Following are the possible SCA Authentication types:

| **SMS_OTP**   | An SCA method, where an OTP linked to the transaction to be authorised is sent to the PSU through an SMS channel. |
| ------------  | ----------------------------------------------------------------------------------------------------------------- |
| **CHIP_OTP**  | An SCA method, where an OTP is generated by a chip card.                                                          |
| **PHOTO_OTP** | An SCA method, where the challenge is a QR code or similar encoded visual data which can be read in by a consumer device or specific mobile app. |
| **PUSH_OTP**  | An OTP is pushed to a dedicated authentication APP and displayed to the PSU.                                      |

Given below is a sample configuration for a `SMS_OTP` authentication.

```
<Berlin>
    <SCA>
        <SCAMethods>
            <AuthenticationObject>
                <AuthenticationType>SMS_OTP</AuthenticationType>
                <AuthenticationVersion>1.0</AuthenticationVersion>
                <AuthenticationMethodId>sms-otp</AuthenticationMethodId>
                <Name>SMS OTP on Mobile</Name>
                <Explanation>SMS based one time password</Explanation>
                <Default>true</Default>
            </AuthenticationObject>
        </SCAMethods>
    </SCA>
</Berlin>
```